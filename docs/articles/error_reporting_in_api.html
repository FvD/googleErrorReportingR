<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Use googleErrorReportingR in an API • googleErrorReportingR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Use googleErrorReportingR in an API">
<meta property="og:description" content="googleErrorReportingR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">googleErrorReportingR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/error_reporting.html">Get started with error reporting</a>
    </li>
    <li>
      <a href="../articles/error_reporting_in_api.html">Use googleErrorReportingR in an API</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ixpantia/googleErrorReportingR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Use googleErrorReportingR in an API</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ixpantia/googleErrorReportingR/blob/HEAD/vignettes/error_reporting_in_api.Rmd" class="external-link"><code>vignettes/error_reporting_in_api.Rmd</code></a></small>
      <div class="hidden name"><code>error_reporting_in_api.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ixpantia/googleErrorReportingR" class="external-link">googleErrorReportingR</a></span><span class="op">)</span></span></code></pre></div>
<p>The following is a tutorial on how to use the
<code>googleErrorReportingR</code> package inside a plumber API. even
though this is meant to be used in an API built using the <a href="https://www.rplumber.io/index.html" class="external-link">plumber</a> package, the same
logic can be used if you API is built with a different tool.</p>
<div class="section level2">
<h2 id="define-central-message-characteristics">Define central message characteristics<a class="anchor" aria-label="anchor" href="#define-central-message-characteristics"></a>
</h2>
<p>In your <code>plumber.R</code> file define the central
characteristics of the error messages you will send from you API. We
suggest at least defining the following:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">message</span> <span class="op">&lt;-</span> <span class="fu">googleErrorReportingR</span><span class="fu">::</span><span class="fu"><a href="../reference/format_error_message.html">format_error_message</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">message</span><span class="op">$</span><span class="va">serviceContext</span><span class="op">$</span><span class="va">service</span> <span class="op">&lt;-</span> <span class="st">"api_name"</span></span>
<span><span class="va">message</span><span class="op">$</span><span class="va">serviceContext</span><span class="op">$</span><span class="va">version</span> <span class="op">&lt;-</span> <span class="st">"api_version"</span></span></code></pre></div>
<p>Nevertheless, if there are other charcateristics in
<code><a href="../reference/format_error_message.html">format_error_message()</a></code> that are the same for all errors
reported from your api, feel free to define them here.</p>
</div>
<div class="section level2">
<h2 id="high-level-definitions">High level definitions<a class="anchor" aria-label="anchor" href="#high-level-definitions"></a>
</h2>
<p>You also need to indicate the error reporting API key and GCP
<code>project_id</code>.</p>
<p>There are different ways to do this, if your API is hosted on Cloud
run, you can define them as environmental variables or secrets. If you
are using a <code>start.sh</code> file, you can define them there es
environmental variables also.</p>
<p>The important thing is that they need to be define at a high level
place that, from the moment the API is started, they are available. We
strongly recommend you keep both of this elements in a secret manager
like GCP’s and not as plain text values.</p>
<p>Note: is not recommended that you define them in a Dockerfile, it
could lead to security issues.</p>
</div>
<div class="section level2">
<h2 id="send-errors-from-your-endpoints">Send errors from your endpoints<a class="anchor" aria-label="anchor" href="#send-errors-from-your-endpoints"></a>
</h2>
<p>The easiest way to catch errors from your endpoint is to<br>
wrap the endpoint’s functionalities in a function and then wrap that
function in a <code><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch()</a></code> that sends an error if found.</p>
<p>The following is a minimal example of the usage of the error
reporting functionality, you can add as much of the
<code><a href="../reference/format_error_message.html">format_error_message()</a></code> parameters as you like:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">error_catcher_from_function</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/conditions.html" class="external-link">tryCatch</a></span><span class="op">(</span></span>
<span>  <span class="fu">your_function</span><span class="op">(</span><span class="va">your_parameters</span><span class="op">)</span>,</span>
<span>  error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">message</span><span class="op">$</span><span class="va">message</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">e</span><span class="op">)</span></span>
<span>    <span class="fu">googleErrorReportingR</span><span class="fu">::</span><span class="fu"><a href="../reference/report_error.html">report_error</a></span><span class="op">(</span><span class="va">message</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Error message to print"</span>, call. <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="test">Test<a class="anchor" aria-label="anchor" href="#test"></a>
</h2>
<p>Test your api by making a request that you know causes the wrapped
function to fail and then go to your GCP’s error reporting interface and
see the error there. Review how the different parameters translate in
the interface and customize more if needed.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Frans van Dunné.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
